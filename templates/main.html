<!DOCTYPE HTML>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Arxiv Sanity Preserver</title>

<!-- MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML">
</script>

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">

<!-- Favicon -->
<link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}" />

<!-- JS -->
<script src="{{ url_for('static', filename='jquery-1.8.3.min.js') }}"></script>
<script src="{{ url_for('static', filename='d3.min.js') }}"></script>
<script src="{{ url_for('static', filename='as-common.js') }}"></script>

<!-- Google Analytics JS -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3698471-25', 'auto');
  ga('send', 'pageview');

</script>

<script>

// passed in from flask as json
var tweets = {{ tweets | tojson }};
var papers = {{ papers | tojson }};
var pid_to_users = {{ pid_to_users | tojson }};
var msg = "{{ msg }}";
var render_format = "{{ render_format }}";
var username = "{{ g.user.username }}";
var numresults = "{{ numresults }}";
var show_prompt = "{{ show_prompt }}";

var urlq = ''; // global will be read in to QueryString when load is done

// when page loads...
$(document).ready(function(){

	urlq = QueryString.q;

  // display message, if any
  if(msg !== '') { d3.select("#rtable").append('div').classed('msg', true).html(msg); }

  // add papers to #rtable
	var done = addPapers(10, false);
  if(done) { $("#loadmorebtn").hide(); }

  // set up inifinite scrolling for adding more papers
  $(window).on('scroll', function(){
    var scrollTop = $(document).scrollTop();
    var windowHeight = $(window).height();
    var bodyHeight = $(document).height() - windowHeight;
    var scrollPercentage = (scrollTop / bodyHeight);
    if(scrollPercentage > 0.9) {
      var done = addPapers(5, true);
      if(done) { $("#loadmorebtn").hide(); }
    }
  });

  // just in case scrolling is broken somehow, provide a button handler explicit
  $("#loadmorebtn").on('click', function(){
    var done = addPapers(5, true);
    if(done) { $("#loadmorebtn").hide(); }
  });

  if(papers.length === 0) { $("#loadmorebtn").hide(); }

	if(!(typeof urlq == 'undefined')) {
		d3.select("#qfield").attr('value', urlq.replace(/\+/g, " "));
	}

  var xb = $("#xbanner");
  if(xb.length !== 0) {
    xb.click(function(){ $("#banner").slideUp('fast'); })
  }

  $("#goaway").on('click', function(){
    $("#prompt").slideUp('fast');
    $.post("/goaway", {}).done(function(data){ });
  });

  var topicTags = $("#topic-tags");
  var topicToggle = $("#topics-toggle");

  if(topicTags.length && topicToggle.length) {
    topicToggle.on('click', function(){
      var expanded = topicTags.hasClass('expanded');
      if(expanded) {
        topicTags.removeClass('expanded').addClass('collapsed');
        topicToggle.text('Show all topics');
      } else {
        topicTags.removeClass('collapsed').addClass('expanded');
        topicToggle.text('Show fewer topics');
      }
    });
  }
});

</script>
</head>

<body>

<!-- HEADER -->
<div id="titdiv">
  <!-- Site information/banner -->
  <a href="/">
    <div id="tittxt">
      <h1>Arxiv Sanity Preserver</h1>
      <div class="site-subtitle">
        Built in spare time by <a href="https://twitter.com/karpathy">@karpathy</a> to accelerate research.<br>
        Serving last {{ totpapers }} papers from cs.[CV|CL|LG|AI|NE]/stat.ML
      </div>
    </div>
  </a>
</div>

<!-- FLASHES -->
{% with flashes = get_flashed_messages() %}
  {% if flashes %}
    <div id="flashesdiv">
      <ul class="flashes">
      {% for message in flashes %}
        <li>{{ message }}</li>
      {% endfor %}
      </ul>
    </div>
  {% endif %}
{% endwith %}

<!-- DONATION PROMPT -->
{% if show_prompt == "yes" %}
<div id="prompt" style="background-color:#fef3c7; padding:1rem; max-width:1400px; margin:1rem auto; font-size:14px; border-radius:0.5rem; border:1px solid #f59e0b;">
Hey there, sorry to interrupt. Arxiv-sanity costs a non-negligible amount of money to host. 
If you love the site, please consider pitching in:
  <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top" style="display:inline-block;">
  <input type="hidden" name="cmd" value="_s-xclick">
  <input type="hidden" name="hosted_button_id" value="DRW9PQ2J3U3RJ">
  <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!" style="display:inline-block;height:14px;">
  <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
  </form>
To nuke this message away for a long time click <span id="goaway" style="text-decoration: underline;cursor: pointer;">here</span>.
</div>
{% endif %}

<!-- MAIN LAYOUT: SIDEBAR + CONTENT -->
<div class="layout-container">
  
  <!-- SIDEBAR: FILTERS -->
  <aside class="filter-panel">
    <h2>Filters</h2>
    <form class="filter-form" method="get" action="/search">
      
      <!-- SEARCH BAR -->
      <div class="filter-group">
        <label for="qfield">Search</label>
        <input name="q" type="search" id="qfield" placeholder="Keywords...">
      </div>

      <!-- TOPICS (Multi-select tags) -->
	  {% set max_visible_topics = 6 %}
      {% set sorted_topics = topics|sort(attribute='count', reverse=True) %}
      <div class="filter-group">
        <label>Topics</label>
          <div class="tag-list collapsed" id="topic-tags">
          {% for topic in sorted_topics %}
            {% set is_extra = (loop.index > max_visible_topics) and (topic.name not in selected_topics) %}
            <label class="tag {% if is_extra %}tag-extra{% endif %}">
              <input
                type="checkbox"
                name="topics[]"
                value="{{ topic.name }}"
                {% if topic.name in selected_topics %}checked{% endif %}
              />
              <span>{{ topic.display_name }} ({{ topic.count }})</span>
            </label>
          {% endfor %}
        </div>
		{% if topics|length > max_visible_topics %}
        <button type="button" class="tag-toggle" id="topics-toggle">Show all topics</button>
        {% endif %}
      </div>

      <!-- SCORE FILTER -->
      <div class="filter-group">
        <label for="scorebar">Minimum Score</label>
        <input
          id="scorebar"
          name="scorebar"
          type="text"
          placeholder="e.g. 2.5"
          inputmode="decimal"
          pattern="[0-9]*[.]?[0-9]*"
        />
      </div>

      <!-- SORT OPTIONS -->
      <div class="sort-options">
       <div class="sort-row">
          <div class="filter-group sort-control">
            <label for="sortby">Sort By</label>
            <div class="select-wrapper">
              {% set sort_by = request.args.get('sortby', 'date') %}
              <select id="sortby" name="sortby" class="select-input">
                <option value="date" {% if sort_by == 'date' %}selected{% endif %}>Date</option>
                <option value="score" {% if sort_by == 'score' %}selected{% endif %}>Score</option>
                <option value="citation" {% if sort_by == 'citation' %}selected{% endif %}>Citation</option>
              </select>
            </div>
          </div>

          <div class="filter-group order-control">
            <label for="sortorder">Order</label>
            {% set sort_order = request.args.get('sortorder', 'desc') %}
            <div class="order-toggle" id="sortorder">
              <label class="order-option">
                <input type="radio" name="sortorder" value="desc" {% if sort_order == 'desc' %}checked{% endif %}>
                <span class="order-button">⬇ Desc</span>
              </label>
              <label class="order-option">
                <input type="radio" name="sortorder" value="asc" {% if sort_order == 'asc' %}checked{% endif %}>
                <span class="order-button">⬆ Asc</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- ACTIONS -->
      <div class="filter-actions">
        <button type="submit" class="btn-primary">Apply</button>
        <button type="reset" class="btn-secondary">Reset</button>
      </div>
    </form>
  </aside>

  <!-- MAIN CONTENT: PAPERS -->
  <main id="maindiv">
    <div id="rtable"></div>

    <div id="loadmore">
      <button id="loadmorebtn">Load more</button>
    </div>
  </main>

</div>

<br><br>
</body>

</html>
