<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Arxiv Sanity Preserver</title>

    <!-- MathJax -->
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    </script>
    <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML">
    </script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}"/>

    <!-- JS -->
    <script src="{{ url_for('static', filename='jquery-1.8.3.min.js') }}"></script>
    <script src="{{ url_for('static', filename='d3.min.js') }}"></script>
    <script src="{{ url_for('static', filename='as-common.js') }}"></script>

    <!-- Google Analytics JS -->
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-3698471-25', 'auto');
        ga('send', 'pageview');

    </script>
    <script>
        var themePreference = null;
        function getStoredTheme() {
            try {
                return localStorage.getItem('theme');
            } catch (error) {
                return themePreference;
            }
        }
        function setStoredTheme(value) {
            themePreference = value;
            try {
                localStorage.setItem('theme', value);
            } catch (error) {
                // ignore storage errors
            }
        }
        (function () {
            var storedTheme = getStoredTheme();
            if (!storedTheme) {
                var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                storedTheme = prefersDark ? 'dark' : 'light';
            }
            if (storedTheme === 'dark') {
                document.documentElement.classList.add('dark-mode');
            }
        })();

        function initThemeToggle() {
            var toggleButton = document.querySelector('.theme-toggle');
            if (!toggleButton) {
                return;
            }
            var setLabel = function () {
                var isDark = document.documentElement.classList.contains('dark-mode');
                toggleButton.innerHTML = isDark
                    ? '<span class="theme-icon" aria-hidden="true">Í•ü</span>'
                    : '<span class="theme-icon" aria-hidden="true">üåô</span>';
                toggleButton.setAttribute('aria-pressed', isDark ? 'true' : 'false');
                toggleButton.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
            };
            setLabel();
            toggleButton.addEventListener('click', function () {
                document.documentElement.classList.toggle('dark-mode');
                var isDark = document.documentElement.classList.contains('dark-mode');
                setStoredTheme(isDark ? 'dark' : 'light');
                setLabel();
            });
        }
        function initSettingsModal() {
            var openButton = document.querySelector('.settings-toggle');
            var overlay = document.getElementById('settings-overlay');
            var modal = document.getElementById('settings-modal');
            if (!openButton || !overlay || !modal) {
                return;
            }
            var closeButton = overlay.querySelector('.settings-close');
            var tabButtons = overlay.querySelectorAll('.settings-tab');
            var panels = overlay.querySelectorAll('.settings-panel');
            var dbContainer = overlay.querySelector('.settings-db-metadata');

            function setActiveTab(tabName) {
                tabButtons.forEach(function (button) {
                    var isActive = button.getAttribute('data-tab') === tabName;
                    button.classList.toggle('is-active', isActive);
                    button.setAttribute('aria-selected', isActive ? 'true' : 'false');
                });
                panels.forEach(function (panel) {
                    var isActive = panel.getAttribute('data-tab-panel') === tabName;
                    panel.classList.toggle('is-active', isActive);
                    panel.setAttribute('aria-hidden', isActive ? 'false' : 'true');
                });
            }

            function formatPercent(value) {
                if (typeof value === 'number') {
                    return value.toFixed(1) + '%';
                }
                return '‚Äî';
            }

            function renderDbMetadata(data) {
                if (!dbContainer) {
                    return;
                }
                var dbItems = (data.available_dbs || []).map(function (entry) {
                    var selected = entry.path === data.selected_db;
                    var statusLabel = entry.exists ? 'Available' : 'Missing';
                    return '<li>' +
                        '<span class="settings-db-name">' + entry.label + '</span>' +
                        '<span class="settings-db-status">' + statusLabel + '</span>' +
                        (selected ? '<span class="settings-db-selected">Active</span>' : '') +
                        '</li>';
                }).join('');
                var ranges = (data.category_ranges || []).map(function (range) {
                    return '<li><span class="settings-range-label">' + range.label +
                        '</span><span class="settings-range-value">' +
                        range.earliest + ' ‚Üí ' + range.latest + '</span></li>';
                }).join('');

                dbContainer.innerHTML = '' +
                    '<div class="settings-db-grid">' +
                    '<div class="settings-db-card">' +
                    '<h4>Database overview</h4>' +
                    '<dl>' +
                    '<div><dt>Total papers</dt><dd>' + (data.total_papers || 0) + '</dd></div>' +
                    '<div><dt>Papers downloaded</dt><dd>' + (data.downloaded_papers || 0) + ' (' +
                    formatPercent(data.downloaded_percent) + ')</dd></div>' +
                    '</dl>' +
                    '</div>' +
                    '<div class="settings-db-card">' +
                    '<h4>Available databases</h4>' +
                    '<ul class="settings-db-list">' + dbItems + '</ul>' +
                    '</div>' +
                    '</div>' +
                    '<div class="settings-db-card">' +
                    '<h4>Category date ranges</h4>' +
                    '<ul class="settings-range-list">' + ranges + '</ul>' +
                    '</div>';
            }

            function loadDbMetadata() {
                if (!dbContainer) {
                    return;
                }
                dbContainer.innerHTML = '<p class="settings-loading">Loading database metadata...</p>';
                fetch('/settings/db_metadata')
                    .then(function (response) { return response.json(); })
                    .then(function (data) { renderDbMetadata(data); })
                    .catch(function () {
                        dbContainer.innerHTML = '<p class="settings-error">Unable to load database metadata.</p>';
                    });
            }

            function openModal() {
                overlay.classList.add('visible');
                modal.classList.add('visible');
                overlay.setAttribute('aria-hidden', 'false');
                setActiveTab('general');
                loadDbMetadata();
            }

            function closeModal() {
                overlay.classList.remove('visible');
                modal.classList.remove('visible');
                overlay.setAttribute('aria-hidden', 'true');
            }

            openButton.addEventListener('click', function () {
                openModal();
            });

            if (closeButton) {
                closeButton.addEventListener('click', function () {
                    closeModal();
                });
            }

            overlay.addEventListener('click', function (event) {
                if (event.target === overlay) {
                    closeModal();
                }
            });

            document.addEventListener('keydown', function (event) {
                if (event.key === 'Escape' && overlay.classList.contains('visible')) {
                    closeModal();
                }
            });

            tabButtons.forEach(function (button) {
                button.addEventListener('click', function () {
                    setActiveTab(button.getAttribute('data-tab'));
                });
            });
        }
    </script>

    <script>

        // passed in from flask as json
        var tweets = {{tweets | tojson }};

        var papers = {{ papers | tojson }};

        var msg = "{{ msg }}";
        var render_format = "{{ render_format }}";
        var numresults = "{{ numresults }}";
        var show_prompt = "{{ show_prompt }}";

        var urlq = ''; // global will be read in to QueryString when load is done

        var ingestPoller = null;
        var ingestLogIndex = 0;
        var ingestJobId = null;
        var recomputePoller = null;
        var recomputeLastStatus = null;
        function resetIngestState() {
            $('#ingest-status-text').text('Preparing to start the ingest process...');
            $('#ingest-progress-bar').css('width', '0%');
            $('.ingest-progress').attr('aria-valuenow', 0);
            $('#ingest-log').empty();
            ingestLogIndex = 0;
            updateIngestButtonProgress('Preparing to start the ingest process...', 0);
        }

        function updateIngestButtonProgress(label, percent) {
            $('#ingest-button-label').text(label);
            if (typeof percent !== 'number') {
                percent = 0;
            }
            $('#ingest-button-progress').css('width', percent + '%');
        }

        function setIngestButtonBusy(isBusy) {
            var button = $('.ingest-submit');
            button.toggleClass('is-busy', isBusy);
            button.attr('aria-busy', isBusy ? 'true' : 'false');
            button.find('.btn-progress').attr('aria-hidden', isBusy ? 'false' : 'true');
            if (!isBusy) {
                updateIngestButtonProgress('Preparing to start the ingest process...', 0);
            }
        }

        function updateIngestProgress(step) {
            var status = $('#ingest-status-text');
            var bar = $('#ingest-progress-bar');
            var progressShell = $('.ingest-progress');

            status.text(step.label);
            bar.css('width', step.percent + '%');
            progressShell.attr('aria-valuenow', step.percent);
            updateIngestButtonProgress(step.label, step.percent);
        }

        function showIngestOverlay() {
            $('#ingest-overlay').attr('aria-hidden', 'false').addClass('visible');
        }

        function hideIngestOverlay() {
            $('#ingest-overlay').attr('aria-hidden', 'true').removeClass('visible');
        }

        function pollIngestStatus(jobId) {
            ingestPoller = setInterval(function () {
                $.getJSON('/ingest/status/' + jobId, function (data) {
                    updateIngestProgress({label: data.label, percent: data.percent});
                    if (data.messages && data.messages.length > ingestLogIndex) {
                        var log = $('#ingest-log');
                        for (var i = ingestLogIndex; i < data.messages.length; i++) {
                            var line = $('<div></div>').text(data.messages[i]);
                            log.append(line);
                        }
                        ingestLogIndex = data.messages.length;
                        log.scrollTop(log[0].scrollHeight);
                    }

                    if (data.done) {
                        clearInterval(ingestPoller);
                        ingestPoller = null;
                        ingestJobId = null;
                        setIngestButtonBusy(false);
                        if (data.error) {
                            $('#ingest-status-text').text('Ingest failed');
                        }
                    }
                }).fail(function () {
                    clearInterval(ingestPoller);
                    ingestPoller = null;
                    ingestJobId = null;
                    setIngestButtonBusy(false);
                });
            }, 1000);
        }
        function showRecomputePanel(message, percent, level) {
            var panel = $('#recompute-status-panel');
            var text = $('#recompute-status-text');
            var progress = $('#recompute-status-percent');
            var levelClass = level ? 'recompute-' + level : '';
            var percentText = '‚Äî';

            text.text(message);
            if (typeof percent === 'number') {
                percentText = percent + '%';
            } else if (typeof percent === 'string' && percent.trim()) {
                percentText = percent;
            }
            progress.text(percentText);
            panel.removeClass('recompute-error recompute-info recompute-success');
            if (levelClass) {
                panel.addClass(levelClass);
            }
            panel.attr('aria-hidden', 'false').addClass('visible');
        }

        function hideRecomputePanel() {
            $('#recompute-status-panel').attr('aria-hidden', 'true').removeClass('visible');
        }

        function getRecomputePercent(state) {
            if (typeof state.percent === 'number') {
                return state.percent;
            }
            if (typeof state.processed === 'number' && typeof state.total === 'number' && state.total > 0) {
                return Math.round((state.processed / state.total) * 100);
            }
            return null;
        }

        function updateRecomputeStatus(state) {
            var status = state.status || 'idle';
            recomputeLastStatus = status;
            var isActive = status === 'running' || status === 'queued';
            var percent = getRecomputePercent(state);
            var message = state.message || (status === 'queued' ? 'Recompute queued...' : 'Recomputing caches...');
            var percentValue = typeof percent === 'number' ? percent : 0;

            if (isActive) {
                showRecomputePanel(message, percent, 'info');
            } else {
                hideRecomputePanel();
                updateRecomputeBadge(status === 'finished');
            }


            if (!ingestJobId && !ingestPoller) {
                if (isActive) {
                    setIngestButtonBusy(true);
                    updateIngestButtonProgress(percentValue + '%', percentValue);
                } else {
                    setIngestButtonBusy(false);
                }
            }
        }

        function fetchRecomputeStatus() {
            $.getJSON('/recompute/status', function (data) {
                updateRecomputeStatus(data);
            });
        }

        function startRecomputePolling() {
            if (!recomputePoller) {
                recomputePoller = setInterval(fetchRecomputeStatus, 2000);
            }
            fetchRecomputeStatus();
        }


        // when page loads...
        $(document).ready(function () {

            urlq = QueryString.q;

            // display message, if any
            if (msg !== '') {
                d3.select("#rtable").append('div').classed('msg', true).html(msg);
            }

            // add papers to #rtable
            var done = addPapers(10, false);
            if (done) {
                $("#loadmorebtn").hide();
            }

            // set up inifinite scrolling for adding more papers
            $(window).on('scroll', function () {
                var scrollTop = $(document).scrollTop();
                var windowHeight = $(window).height();
                var bodyHeight = $(document).height() - windowHeight;
                var scrollPercentage = (scrollTop / bodyHeight);
                if (scrollPercentage > 0.9) {
                    var done = addPapers(5, true);
                    if (done) {
                        $("#loadmorebtn").hide();
                    }
                }
            });

            // just in case scrolling is broken somehow, provide a button handler explicit
            $("#loadmorebtn").on('click', function () {
                var done = addPapers(5, true);
                if (done) {
                    $("#loadmorebtn").hide();
                }
            });

            if (papers.length === 0) {
                $("#loadmorebtn").hide();
            }

            if (!(typeof urlq == 'undefined')) {
                d3.select("#qfield").attr('value', urlq.replace(/\+/g, " "));
            }

            var xb = $("#xbanner");
            if (xb.length !== 0) {
                xb.click(function () {
                    $("#banner").slideUp('fast');
                })
            }

            $("#goaway").on('click', function () {
                $("#prompt").slideUp('fast');
                $.post("/goaway", {}).done(function (data) {
                });
            });

            var topicSearch = $("#topic-search");
            var topicTags = $("#topic-tags");

            if (topicTags.length && topicSearch.length) {
                var tags = topicTags.find('.tag');

                topicSearch.on('input', function () {
                    var query = $(this).val().toLowerCase().trim();

                    if (query === '') {
                        tags.show();
                        topicTags.addClass('limited');
                    } else {
                        tags.each(function () {
                            var text = $(this).text().toLowerCase();
                            $(this).toggle(text.indexOf(query) !== -1);
                        });
                        topicTags.addClass('limited');
                    }
                });
            }

            var filterForm = $('.filter-form');
            if (filterForm.length) {
                filterForm.on('reset', function () {
                    setTimeout(function () {
                        if (topicSearch.length && topicTags.length) {
                            topicSearch.val('');
                            topicTags.find('.tag').show();
                            topicTags.addClass('limited');
                        }
                    }, 0);
                });
            }

            var ingestForm = $('#ingest-form');
            if (ingestForm.length) {
                ingestForm.on('submit', function (event) {
                    event.preventDefault();
                    if (ingestJobId && ingestPoller) {
                        showIngestOverlay();
                        return;
                    }
                    resetIngestState();
                    showIngestOverlay();
                    setIngestButtonBusy(true);

                    $.post('/ingest', ingestForm.serialize(), function (data) {
                        if (data.error) {
                            $('#ingest-status-text').text(data.error);
                            setIngestButtonBusy(false);
                            ingestJobId = null;
                            return;
                        }
                        if (data.job_id) {
                            ingestJobId = data.job_id;
                            pollIngestStatus(ingestJobId);
                        }
                    }, 'json').fail(function () {
                        $('#ingest-status-text').text('Could not start ingest. Please try again.');
                        setIngestButtonBusy(false);
                        ingestJobId = null;
                    });
                });
            }
            startRecomputePolling();

            initLayoutToggle('.layout-btn');
            initThemeToggle();
            initSettingsModal();
            $('#ingest-overlay').on('click', function (event) {
                if (event.target === this) {
                    hideIngestOverlay();
                }
            });
        });

    </script>
</head>

<body>

<!-- HEADER -->
<div id="titdiv">
    <!-- Site information/banner -->
    <div class="header-actions">
        <button type="button" class="settings-toggle" aria-label="Open settings" aria-haspopup="dialog"
                aria-controls="settings-overlay">
            <span class="settings-icon" aria-hidden="true">‚öôÔ∏è</span>
        </button>
        <button type="button" class="theme-toggle" aria-label="Switch to dark mode" aria-pressed="false">
            <span class="theme-icon" aria-hidden="true">üåô</span>
        </button>
    </div>
    <a href="/">
        <div id="tittxt">
            <h1>Arxiv Sanity Preserver</h1>
            <div class="site-subtitle">
                Modified from Karpathy's version with updated UI & backend.<br>
                Serving last {{ totpapers }} papers from cs.[CV|CL|LG|AI|NE]/stat.M
            </div>
        </div>
    </a>
</div>

<!-- FLASHES -->
{% with flashes = get_flashed_messages() %}
{% if flashes %}
<div id="flashesdiv">
    <ul class="flashes">
        {% for message in flashes %}
        <li>{{ message }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}
{% endwith %}

<!-- MAIN LAYOUT: SIDEBAR + CONTENT -->
<div class="layout-container">

    <!-- SIDEBAR: FILTERS -->
    <aside class="filter-panel">
        <h2>Filters</h2>
        <form class="filter-form" method="get" action="/search">

            <!-- SEARCH BAR -->
            <div class="filter-group">
                <label for="qfield">Search</label>
                <input name="q" type="search" id="qfield" placeholder="Keywords..." value="{{ search_query }}">
            </div>

            <!-- TOPICS (Multi-select tags) -->

            {% set sorted_topics = topics|sort(attribute='count', reverse=True) %}
            {% set selected_sorted = sorted_topics|selectattr('name', 'in', selected_topics)|list %}
            {% set unselected_sorted = sorted_topics|rejectattr('name', 'in', selected_topics)|list %}
            {% set display_topics = selected_sorted + unselected_sorted %}
            {% set max_label_length = 18 %}
            <div class="filter-group">
                <label>Topics</label>
                <div class="topic-cluster">
                    <input
                            type="search"
                            id="topic-search"
                            class="topic-search"
                            placeholder="Search topics..."
                            autocomplete="off"
                    />
                    <div class="tag-list limited" id="topic-tags">
                        {% for topic in display_topics %}
                        {% set full_name = topic.display_name %}
                        {% if full_name|length > max_label_length %}
                        {% set truncated_candidate = full_name[:max_label_length] %}
                        {% set trimmed = truncated_candidate.rsplit(' ', 1)[0] %}
                        {% set truncated_name = (trimmed if trimmed else truncated_candidate).rstrip() ~ '...' %}
                        {% else %}
                        {% set truncated_name = full_name %}
                        {% endif %}
                        <label class="tag">
                            <input
                                    type="checkbox"
                                    name="topics[]"
                                    value="{{ topic.name }}"
                                    {% if topic.name in selected_topics %}checked{% endif %}
                            />
                            <span data-full-name="{{ full_name }}" title="{{ full_name }}">{{ truncated_name }} ({{ topic.count }})</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- SCORE FILTER -->
            <div class="filter-group">
                <label for="scorebar">Minimum Score</label>
                <input
                        id="scorebar"
                        name="min_score"
                        type="text"
                        placeholder="e.g. 2.5"
                        inputmode="decimal"
                        pattern="[0-9]*[.]?[0-9]*"
                        value="{{ min_score }}"
                />
            </div>

            <!-- AVAILABILITY FILTERS -->
            <div class="filter-group">
                <label>Others</label>
                <label class="checkbox">
                    <input
                            type="checkbox"
                            name="open_source"
                            value="1"
                            {% if open_source %}checked{% endif %}
                    />
                    <span>Open-Source</span>
                </label>
                <label class="checkbox">
                    <input
                            type="checkbox"
                            name="publication_status"
                            value="presented"
                            {% if 'presented' in publication_statuses %}checked{% endif %}
                    />
                    <span>Presented at conference</span>
                </label>
            </div>


            <!-- SORT OPTIONS -->
            <div class="sort-options">
                <div class="sort-row">
                    <div class="filter-group sort-control">
                        <label for="sortby">Sort By</label>
                        <div class="sort-control-row">
                            <div class="select-wrapper sort-select">
                                {% set sort_by_value = sort_by or 'date' %}
                                <select id="sortby" name="sortby" class="select-input">
                                    <option value="date" {% if sort_by_value==
                                    'date' %}selected{% endif %}>Date</option>
                                    <option value="score" {% if sort_by_value==
                                    'score' %}selected{% endif %}>Score</option>
                                    <option value="citation" {% if sort_by_value==
                                    'citation' %}selected{% endif %}>Citation</option>
                                </select>
                            </div>
                            {% set sort_order_value = sort_order or 'desc' %}
                            <div class="order-toggle" id="sortorder">
                                <label class="order-option">
                                    <input type="radio" name="sortorder" value="desc" {% if sort_order_value== 'desc'
                                    %}checked{% endif %}>
                                    <span class="order-button order-desc">DESC</span>
                                </label>
                                <label class="order-option">
                                    <input type="radio" name="sortorder" value="asc" {% if sort_order_value== 'asc'
                                    %}checked{% endif %}>
                                    <span class="order-button order-asc">ASC</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ACTIONS -->
            <div class="filter-actions">
                <button type="submit" class="btn-primary">Search</button>
                <button type="reset" class="btn-secondary">Reset</button>
            </div>
        </form>

        <div class="ingest-card">
            <h3>Add Paper</h3>
            <form id="ingest-form" class="ingest-form" method="post" action="/ingest">
                <div class="filter-group">
                    <label for="paper-id-input">arXiv identifier</label>
                    <input
                            id="paper-id-input"
                            name="paper_id"
                            type="text"
                            placeholder="e.g. 1512.08756v2"
                            required
                    />
                </div>
                <p class="ingest-help">We will download the PDF, extract text, and refresh caches for the new paper.</p>
                <button type="submit" class="btn-primary ingest-submit" aria-busy="false">
                    <span class="btn-label">Add paper</span>
                    <span class="btn-progress" aria-hidden="true">
                        <span class="btn-progress-label" id="ingest-button-label">Preparing to start the ingest process...</span>
                        <span class="btn-progress-track">
                            <span class="btn-progress-bar" id="ingest-button-progress"></span>
                        </span>
                    </span>
                </button>
            </form>
            <div class="recompute-status-panel" id="recompute-status-panel" aria-hidden="true">
                <div class="recompute-status-content">
                    <span id="recompute-status-text">Recomputing caches...</span>
                    <span class="recompute-progress" id="recompute-status-percent">0%</span>
                </div>
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT: PAPERS -->
    <main id="maindiv">
        <div class="layout-toolbar">
            <span class="layout-label">Layout</span>
            <div class="layout-toggle" role="group" aria-label="Toggle paper layout">
                <button
                        type="button"
                        class="layout-btn"
                        data-layout="single"
                        aria-label="Single column layout"
                        title="Single column layout"
                >
                    ‚ñ¢
                </button>
                <button type="button" class="layout-btn" data-layout="double" aria-label="Two-column layout"
                        title="Two-column layout">
                    <svg aria-hidden="true" viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                        <rect x="3" y="3" width="4" height="4" rx="0.6"></rect>
                        <rect x="10" y="3" width="4" height="4" rx="0.6"></rect>
                        <rect x="17" y="3" width="4" height="4" rx="0.6"></rect>

                        <rect x="3" y="10" width="4" height="4" rx="0.6"></rect>
                        <rect x="10" y="10" width="4" height="4" rx="0.6"></rect>
                        <rect x="17" y="10" width="4" height="4" rx="0.6"></rect>

                        <rect x="3" y="17" width="4" height="4" rx="0.6"></rect>
                        <rect x="10" y="17" width="4" height="4" rx="0.6"></rect>
                        <rect x="17" y="17" width="4" height="4" rx="0.6"></rect>
                    </svg>
                </button>
            </div>
        </div>
        {% if no_results_message %}
        <div class="msg">{{ no_results_message }}</div>
        {% endif %}

        <div id="rtable" data-layout="double"></div>

        <div id="loadmore">
            <button id="loadmorebtn">Load more</button>
        </div>
    </main>
</div>

<div class="settings-overlay" id="settings-overlay" aria-hidden="true">
    <div class="settings-modal" id="settings-modal" role="dialog" aria-labelledby="settings-modal-title"
         aria-describedby="settings-modal-description">
        <div class="settings-header">
            <h3 id="settings-modal-title">Settings</h3>
            <button type="button" class="settings-close" aria-label="Close settings">√ó</button>
        </div>
        <p id="settings-modal-description" class="settings-description">
            Review application preferences, database status, and download rules.
        </p>
        <div class="settings-tabs" role="tablist">
            <button type="button" class="settings-tab is-active" data-tab="general" role="tab" aria-selected="true">
                General
            </button>
            <button type="button" class="settings-tab" data-tab="database" role="tab" aria-selected="false">
                Database
            </button>
            <button type="button" class="settings-tab" data-tab="downloading" role="tab" aria-selected="false">
                Downloading rules
            </button>
        </div>
        <div class="settings-panel is-active" data-tab-panel="general" role="tabpanel" aria-hidden="false">
            <div class="settings-panel-content">
                <h4>General</h4>
                <p>Use the theme toggle to switch between light and dark mode. Settings are stored locally in your
                    browser.</p>
            </div>
        </div>
        <div class="settings-panel" data-tab-panel="database" role="tabpanel" aria-hidden="true">
            <div class="settings-panel-content settings-db-metadata">
                <p class="settings-loading">Loading database metadata...</p>
            </div>
        </div>
        <div class="settings-panel" data-tab-panel="downloading" role="tabpanel" aria-hidden="true">
            <div class="settings-panel-content">
                <h4>Downloading rules</h4>
                <ul>
                    <li>PDF downloads are stored in <code>data/pdf</code>.</li>
                    <li>Recomputations are queued after new papers are ingested.</li>
                    <li>Download scripts respect arXiv rate limits and include a user agent.</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="ingest-overlay" id="ingest-overlay" aria-hidden="true">
    <div class="ingest-modal" role="dialog" aria-labelledby="ingest-modal-title" aria-describedby="ingest-status-text">
        <h3 id="ingest-modal-title">Adding new paper</h3>
        <p class="ingest-status" id="ingest-status-text">Preparing to start the ingest process...</p>
        <div class="ingest-progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="ingest-progress-bar" id="ingest-progress-bar" style="width: 0%;"></div>
        </div>
        <div class="ingest-log" id="ingest-log" aria-live="polite"></div>
        <p class="ingest-note">We'll download the PDF, extract the text, and refresh caches. Feel free to keep this tab
            open while we work.</p>
    </div>
</div>

<br><br>
</body>

</html>
